!function(e){function t(n){if(a[n])return a[n].exports;var i=a[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");a(1);var n;AFRAME.registerSystem("audioanalyser",{init:function(){this.analysers={}},getOrCreateAnalyser:function(e){n||(n=new AudioContext);var t=this.analysers,a=n.createAnalyser(),i=e.src,l=i.getAttribute("src");if(t[l])return t[l];var s=n.createMediaElementSource(i);return s.connect(a),a.connect(n.destination),a.smoothingTimeConstant=e.smoothingTimeConstant,a.fftSize=e.fftSize,t[l]=a,t[l]}}),AFRAME.registerComponent("audioanalyser",{schema:{enableBeatDetection:{"default":!0},enableLevels:{"default":!0},enableWaveform:{"default":!0},enableVolume:{"default":!0},fftSize:{"default":2048},smoothingTimeConstant:{"default":.8},src:{type:"selector"},unique:{"default":!1}},init:function(){this.analyser=null,this.levels=null,this.waveform=null,this.volume=0},update:function(){function e(e){a.analyser=e,t.enableLevels&&(a.levels=new Uint8Array(a.analyser.frequencyBinCount)),t.enableWaveform&&(a.waveform=new Uint8Array(a.analyser.fftSize)),a.el.emit("audioanalyser-ready",{analyser:e})}var t=this.data,a=this,n=this.system;t.src&&e(t.unique?n.createAnalyser(t):n.getOrCreateAnalyser(t))},tick:function(){var e=this.data;if(this.analyser){if((e.enableLevels||e.enableVolume)&&this.analyser.getByteFrequencyData(this.levels),e.enableWaveform&&this.analyser.getByteTimeDomainData(this.waveform),e.enableVolume||e.enableBeatDetection){for(var t=0,a=0;a<this.levels.length;a++)t+=this.levels[a];this.volume=t/this.levels.length}if(e.enableBeatDetection){var n=.99,i=60,l=.15;volume=this.volume,this.beatCutOff||(this.beatCutOff=volume),volume>this.beatCutOff&&volume>l?(console.log("[audioanalyser] Beat detected."),this.el.emit("audioanalyser-beat"),this.beatCutOff=1.5*volume,this.beatTime=0):this.beatTime<=i?this.beatTime++:(this.beatCutOff*=n,this.beatCutOff=Math.max(this.beatCutOff,l))}}}})},function(e,t){AFRAME.registerComponent("audioanalyser-levels-scale",{dependencies:["audioanalyser"],schema:{max:{"default":20},multiplier:{"default":100}},tick:function(e){var t,a,n=this.data;if(a=this.el.components.audioanalyser.levels){t=this.el.children;for(var i=0;i<t.length;i++)t[i].setAttribute("scale",{x:1,y:Math.min(n.max,Math.max(a[i]*n.multiplier,.05)),z:1})}}})}]);